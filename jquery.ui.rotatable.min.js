(function(d,f){function g(a){e(a,0);var b=a.offset();e(a,a.data("angle"));var c=b.left+a.width()/2;a=b.top+a.height()/2;return[c,a]}function e(a,b){a.css("transform","rotate("+b+"rad)");a.css("-moz-transform","rotate("+b+"rad)");a.css("-webkit-transform","rotate("+b+"rad)");a.css("-o-transform","rotate("+b+"rad)")}function l(a){if(c)return!1}function m(a){if(!c)return!1;var b=g(c);a=Math.atan2(a.pageY-b[1],a.pageX-b[0])-h+k;e(c,a);c.data("angle",a);return!1}function n(a){c=d(this).parent();var b= g(c);h=Math.atan2(a.pageY-b[1],a.pageX-b[0]);k=c.data("angle");d(document).on("mousemove",m);return!1}d.widget("ui.rotatable",d.ui.mouse,{options:{handle:!1,angle:0},handle:function(a){if(a===f)return this.options.handle;this.options.handle=a},angle:function(a){if(a===f)return this.options.angle;this.options.angle=a;e(this.element,this.options.angle)},_create:function(){var a;this.options.handle?a=this.options.handle:(a=d(document.createElement("div")),a.addClass("ui-rotatable-handle"));a.draggable({helper:"clone", start:l});a.on("mousedown",n);a.appendTo(this.element);this.element.data("angle",this.options.angle);e(this.element,this.options.angle)}});var c,h,k;d(document).on("mouseup",function(a){if(c)return d(document).unbind("mousemove"),setTimeout(function(){c=!1},10),!1})})(jQuery);